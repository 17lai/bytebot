[supervisord]
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
loglevel=info
user=root


[program:hypervisor]
; Start the hypervisor after waiting for websockify to be ready
command=sh -c 'echo "Waiting for websockify on port 6080 (hypervisor)..."; while ! nc -z localhost 6080; do sleep 2; done; echo "Websockify is ready, starting hypervisor"; exec node /hypervisor/dist/main.js'
directory=/hypervisor
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
redirect_stderr=true

[program:novnc-http]
; Serve the noVNC client files using Python's HTTP server on port 6081.
; Wait for websockify to be ready on port 6080
command=sh -c 'echo "Waiting for websockify on port 6080 (noVNC)..."; while ! nc -z localhost 6080; do sleep 2; done; echo "Websockify is ready, starting noVNC HTTP server on port 6081"; exec python3 -m http.server 6081 --directory /opt/noVNC'
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
redirect_stderr=true

[program:websockify]
; Run websockify to proxy VNC traffic from WebSocket to TCP
command=sh -c 'echo "Starting websockify to proxy from port 6080 to VNC port 5900"; sleep 5; websockify 6080 localhost:5900'
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
redirect_stderr=true
